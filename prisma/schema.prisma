generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Admin {
  id       String @map("_id") @id @default(auto()) @db.ObjectId
  login    String             @unique
  password String
}

model User {
  id                String    @map("_id") @id @default(auto()) @db.ObjectId
  name              String
  surname           String
  email             String                @unique
  phoneNumber       String?
  password          String
  createdAt         DateTime              @default(now())

  resetToken        String?
  resetTokenExpiry  DateTime?

  isVerified        Boolean               @default(false)
  emailVerifyToken  String?
  emailVerifyExpiry DateTime?

  favoriteProducts  String[]              @db.ObjectId
  mainAddressId     String?               @db.ObjectId

  @@index([mainAddressId])
}


model Address {
  id                                       String   @map("_id") @id @default(auto()) @db.ObjectId

  userId                                   String               @db.ObjectId

  country     String   // Canada
  addressLine String   // 123 Maple Street
  city        String   // Toronto
  province    String   // Ontario
  postalCode  String   // M4B 1B3

  company     String?  // Optional
  apartment   String?  // Apt. 5B

  createdAt                                DateTime             @default(now())
  updatedAt                                DateTime             @updatedAt

  @@index([userId])
}

model Product {
  productGroup String?
  isBestSeller Boolean
  isActive     Boolean
  id           String   @map("_id") @id @default(auto()) @db.ObjectId
  title        String
  description  String
  anotherInfo  String?
  brandName    String?
  technicalImg String?
  slug         String               @unique
  category     String

  images       String[]
  inStock      Boolean              @default(true)

  specs        Spec[]   @relation("ProductSpecs")
  options      Option[] @relation("ProductOptions")

  createdAt    DateTime             @default(now())
}

model Spec {
  id        String  @map("_id") @id @default(auto()) @db.ObjectId

  productId String              @db.ObjectId
  product   Product @relation(fields: [productId], references: [id], name: "ProductSpecs", onDelete: Cascade)

  key       String
  value     String
  group     String

  @@index([group])
  @@index([group, value])
  @@index([productId])
}


model Option {
  id        String  @map("_id") @id @default(auto()) @db.ObjectId

  productId String              @db.ObjectId
  product   Product @relation(fields: [productId], references: [id], name: "ProductOptions", onDelete: Cascade)

  label     String
  value     String?
  price     Float
  discount  Float?

  unit      String?

  isMain    Boolean             @default(false)
  inStock   Boolean             @default(true)
}

model Order {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  status           String   // pending | paid | cancelled
  orderStatus      String

  items            Json     // ← масив товарів, як у тебе

  subtotal         Float
  shippingPrice    Float
  taxPrice         Float
  total            Float

  // Stripe
  stripeSessionId  String? 
  paymentIntentId String?

  // Customer
  email            String
  phoneNumber       String
  name             String
  surname         String
  address          Json?

  createdAt        DateTime @default(now())
  paidAt           DateTime?

  deliveryLink    String?
  deliveryTrackNumber String?

  notes String?

  @@map("orders")
}


